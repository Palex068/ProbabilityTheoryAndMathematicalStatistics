# Лекция №5 Тестирование гипотез (параметрические тесты)

Цель лекции:
+	Научиться формулировать гипотезы 
+	Изучить параметрические тесты и условия их применимости
+	Провести тестирование гипотез с использованием t и Z критерия
+	Научиться правильно интерпретировать результат  с использованием величины p-value
+	Сделать проверку на нормальность с помощью графического метода и с помощью теста Шапиро-Уилка

Материал прошлого урока:

Последним, что мы изучили, были  нормальное распределение и центральную предельную теорему.<br> 
Сегодня будем знакомиться с параметрическими критериями, используемыми для тестирования гипотез.<br>  
Мы будем сегодня не раз обращаться  к изученному материалу, потому что применение параметрических тестов подразумевает нормальность генеральной совокупности, из которой мы брали выборки, а центральная предельная теорема легла в основу тестирования гипотез.

## План лекции 5:
1. [Алгоритм проведение тестирования гипотез](#алгоритм-проведение-тестирования-гипотез)
2. [Нулевая гипотеза  $H_0$ и  альтернативная гипотез $H_1$](#нулевая-гипотеза-и-альтернативная-гипотез)
3. [Выбор уровня статистической значимости $α$](#выбор-уровня-статистической-значимости)
4. [Выбор статистического критерия и вывод](#выбор-статистического-критерия-и-вывод)
5. [Ошибки при тестировании гипотез.](#ошибки-при-тестировании-гипотез)
6. [Критерий Стьюдента.](#критерий-стьюдента)
7. [P-value](#p-value)
8. [Виды статистических гипотез](#виды-статистических-гипотез)
9. [Проверка на нормальность (Шапиро - тест и QQ-график)](#проверка-на-нормальность-шапиро---тест-и-qq-график)
10. [Решение задач](#решение-задач-семинар-5)
11. [Домашняя работа](/HW005.ipynb)

[Содержание курса](/README.MD)

<hr>

## Алгоритм проведение тестирования гипотез

На предыдущих лекциях я упоминала, что обычно у нас нет доступа ко всей генеральной совокупности по ряду причин (дорого, долго, после измерения объект нельзя вернуть обратно в совокупность).<br> 

![ЦПТ](/Pictures/005_019.PNG)

И поэтому в реальной жизни часто прибегают к выборочному контролю. <br>
Предположим, у нас есть случайная величина (далее СВ) «Рост».<br> 

Мы берем первую выборку, измеряем по ней среднее арифметическое и получаем некоторую точечную оценку генеральной совокупности, затем можем взять еще одну выборку и получить по ней новую точечную оценку генеральной совокупности, потом взять третью выборку и снова получить  какую-то новую точечную оценку генеральной совокупности и т.д.<br> 
Т.е. точечная оценка будет меняться от выборки к выборке. <br>
Т.е. средняя по выборке есть случайная величина. (Мы это уже рассматривали, когда изучали центральную предельную теоремы). <br>

Значит, мы не можем взять какую-то одну точечную оценку и сказать, что вот именно эта точечная оценка и будет истинным средним арифметическим всей генеральной совокупности. <br>
Не можем, потому что мы этого не знаем наверняка. <br>
И вот здесь нам как раз и помогает такой метод, как тестирование гипотез. <br>
Он позволяет нам сравнивать параметры распределений. Т.е. с помощью тестирования гипотез мы хотим ответить на вопрос, а видим ли мы статистически значимые различия, например, между 2мя средними арифметическими. Что это значит?

__Статистическая гипотеза – это предположение о неизвестном распределении случайных величин, соответствующих каким-либо представлениям о том явлении, которое изучается.__

![Статистическая гипотеза](/Pictures/005_038.PNG)

Давайте сразу приведем пример. <br>
По аутсорсингу закупаются детали у поставщика. <br>
Поставщик заявляет, что он выпускает детали с диаметром 10 мм. <br>
Прежде, чем делать большую закупку, проведем контроль: проверим, правда ли детали выпускаются с размером $10$ мм.  <br>
Для этого  взяли выборку из $16$ деталей и получили средний диаметр по этой выборки $10.3$ мм. <br>
И вот вопрос, а является ли разница в $0.3$ мм статистически значимой или нет.

Еще раз вспомним центральную предельную теорему, которая гласит, что среднее выборочное стремится к нормальному распределению с мю таким же, как у генеральной совокупности и дисперсией, равной дисперсии генеральной совокупности, деленой на объем выборки. <br>

Т.е. средняя выборочная – это случайная величина, т.е. меняется от выборки к выборке, иным словами, это не фиксированное одно и то же значение, которое мы будем получать во всех выборках. (Еще раз посмотрите на знакомый уже рисунок, где изображено распределение среднего выборочного значения)

![Тестирование гипотез](/Pictures/005_001.png)

А значит, мы хотим понять, а являются ли  различия случайными или, все-таки, наше значение по выборке принадлежит другой генеральной совокупности, т.е. с другим размером диаметра деталей. <br>
Т.о. если различия случайны, то мы считаем, что различий между тем, что мы измерили и тем, что заявлено поставщиком о генеральной совокупности, не являются статистически значимыми. <br>
Но если различие велико, то мы обнаруживаем статистически значимое различие.      

При тестировании гипотез формулируется $2$ гипотезы. <br>
Одна из них нулевая, которая гласит, что различий нет, и противоположная гипотеза, альтернативная, которая заявляет, что  есть статистически значимые различия.

Метод тестирования гипотез имеет определенный алгоритм.
1. Формулирование нулевой $H_0$ и альтернативной гипотез $H_1$
2. Выбор уровня статистической значимости $α$
3. Выбор статистического критерия
4. Расчет наблюдаемого критерия
5. Сравнение табличного и наблюдаемого значений критерия
6. Вывод

Сейчас мы пройдемся по каждому из этих этапов.

[План лекции](#план-лекции-5)

<hr>

## Нулевая гипотеза  $H_0$ и  альтернативная гипотез $H_1$

![Нулевая гипотеза](/Pictures/005_020.PNG)

![Нулевая гипотеза](/Pictures/005_021.PNG)

![Нулевая гипотеза](/Pictures/005_022.PNG)

__Нулевая и альтернативная гипотезы__ – это две противоположные гипотезы. 

Если принимается нулевая гипотеза, то альтернативная гипотеза отвергается, и наоборот, если принимается альтернативная, то нулевая отвергается. 

Нулевая гипотеза $H_0$   всегда звучит едино. Различий нет.

Математически мы можем записать это, как $μ=μ_0$.<br> 
Пока не будет доказано, что верна альтернативная гипотеза, верной считается $H_0$.

В альтернативную гипотезу $H_1$ мы вкладываем наше заявление о статистически значимых различиях. <br>
Она может быть сформулирована тремя способами, все зависит от поставленной задачи.
1. $μ>μ_0$ (вариант для нашего примера, т.к. мы получили $μ=10.3$  больше, чем заявлял производитель)
2. $μ<μ_0$
3. $μ ≠μ_0$ (двусторонний тест)

![Нулевая гипотеза](/Pictures/005_002.png)

![Статистическая гипотеза](/Pictures/005_039.PNG)

![Альтернативная гипотеза](/Pictures/005_040.PNG)

![Критическая область](/Pictures/005_046.PNG)

![Критическая область](/Pictures/005_048.PNG)

![Критическая область](/Pictures/005_049.PNG)

[План лекции](#план-лекции-5)

<hr>

## Выбор уровня статистической значимости $α$

Выбор уровня статистической значимости $α$ делается на усмотрение того, кто проводит тест. 

![Выбор уровня статистической значимости](/Pictures/005_023.PNG)

Обычно это $0.01 (1\%), 0.05 (5\%)$ или $0.1 (10\%)$. <br>
Если нет никаких предпосылок, то смело берите $0.05$. <br>

Отсечка $α$ разделяет график на область принятия нулевой гипотезы $H_0$  и альтернативной гипотезы $H_1$ . <br>

На рисунке выше эта отсечка представлена красной линией.  

Хочу заметить, что на рисунках изображены распределения не генеральных совокупностей, а распределения средних выборочных. <br>
Т.е. если мы выбираем $α=0.05$, это означает, что мы отсекаем $5\%$ значений средних по выборкам у распределения, соответствующего  гипотезе $H_0$ ,  причем эти $5\%$ значений будут попадать теперь в область принятия гипотезы $H_1$.<br> 

Вернемся к этому, когда будем говорить об ошибках.

Важно помнить, что уровень статистической значимости всегда выбирается заранее.

[План лекции](#план-лекции-5)

<hr>

## Выбор статистического критерия и вывод

![Выбор статистики S](/Pictures/005_041.PNG)

![Выбор статистики S](/Pictures/005_042.PNG)

![Выбор статистики S](/Pictures/005_043.PNG)

![Выбор статистического критерия и вывод](/Pictures/005_024.PNG)

После того, как вы определились с гипотезами, перед вами встает задача правильно определиться с критерием. <br>
Критерии делятся на параметрические и непараметрические. 

Параметрические критерии – это $Z, t$ ( критерий Стьюдента) для сравнения двух выборок. <br>
Они предполагают, что выборка взята из нормально распределенной генеральной совокупности, более того предполагают равенство дисперсий в группах. <br>
Если эти условия не выполняются то лучше воспользоваться непараметрическим тестом, основанным на сумме рангов, например, критерием суммы рангов Манна—Уитни. <br>
Но сегодня речь пойдет  о наиболее используемых параметрических тестах: $Z$ и $t$ критериях.

Вся идея теста сводится к тому, чтобы найти расчетное значение и сравнить его с табличным значением, соответствующим выбранному уровню значимости  $α$.

![Расчет наблюдаемого критерия](/Pictures/005_025.PNG)

Если у нас условия применимости параметрических тестов соблюдены, то в случае известной сигмы генеральной совокупности более предпочтителен $Z-$ критерий, в противном случае -  критерий Стьюдента $t$. <br>
Студенты часто спрашивают, а откуда может быть известна сигма генеральной совокупности. 

Ответ: из предыдущих исследований или, если мы выпускаем нашу продукцию давно и у нас накоплено очень много данных о ее некотором параметре, то рассчитанную на практике сигму мы можем принять за истинное значение.

Вернемся к задаче, которую мы будем использовать в качестве примера на протяжении всего этого урока.

Например, для нашей задачи о деталях с диаметром $10$ мм график будет выглядеть следующим образом:

![Выбор статистического критерия и вывод](/Pictures/005_003.png)

Мы знаем, что диаметры следуют нормальному распределению и пусть у нас известно среднее квадратичное отклонение генеральной совокупности, равное $1$ мм.<br> 
Значит, нам следует использовать критерий $Z$.

Мы знаем, что производитель заявляет среднее арифметическое $10$ мм, но мы получили $10.3$ мм и к тому же мы знаем сигму генеральной совокупности. <br>
Давайте измерим расстояние в универсальной единице измерения в нормальном распределении, а именно посмотрим, а в скольких сигмах лежит $10.3$ мм от $10$ мм. <br>
$10.3-10 = 0.3$ мм. <br>
Сколько же сигм лежит в этом отрезке $0.3$ мм.

Чему равна сигма?  Помните, я выше писала, что мы на графиках изображаем распределение средних выборочных. <br>
В условии задачи нам дана сигма генеральной совокупности $1$ мм. <br>
Значит, сигма для изображенного ниже распределения на рисунке, будет являться стандартной ошибкой среднего $(SE)$. <br>
Согласно центральной предельной теореме $SE = \dfrac{\sigma}{\sqrt{n}}$. <br>

Поскольку выборка была из $16$ деталей, то  получаем $\dfrac{1}{4}$

![Выбор статистического критерия и вывод](/Pictures/005_004.png)

Осталось посчитать в скольких $SE$ $10.3$ лежит от $10$ мм.

$\dfrac{10.3-10}{1/4} = 1.2$

$1.2$ – это наш расчетный $Z$ критерий по выборке.

А вот табличный критерий надо найти для $α = 5\%$.<br> 
Поскольку на рисунке $α$ отсекает $0.05$ справа, то ниже отсечки лежат $0.95$ или $95\%$ всех значений стандартного нормального распределения. <br>
По таблице $Z$-значений сначала ищем долю $0.95$ ( обвела в рамочку на рисунке ниже). <br>
А потом смотрим, на пересечении каких составных частей $Z$ лежит эта доля. <br>
Т.е. мы делаем обратное действие тому, которое изучили на прошлом уроке. 

Приблизительное $Z$ табличное $1.645$

![Выбор статистического критерия и вывод](/Pictures/005_005.png)

Получается, что расчетное значение $1.2$ попадает в область принятия гипотезы $H_0$. <br>
Оно меньше $1.645$. <br>
Т.е. делаем вывод, что верна нулевая гипотеза о том, что размер деталей на самом деле и есть $10$ мм на уровне значимости $5\%$.

![Сравнение табличного и наблюдаемого значения. Вывод](/Pictures/005_026.PNG)

[План лекции](#план-лекции-5)

<hr>

## Ошибки при тестировании гипотез.

![Ошибки первого и второго рода](/Pictures/005_044.PNG)

Так зачем мы упоминаем в выводе уровень статистической значимости? <br>
При тестировании гипотез нельзя полностью избежать ошибок. <br>

![Варианты ошибок при тестировании гипотез](/Pictures/005_027.PNG)

Обратите внимание на графике с распределениями, где $α$ закрашена красным цветом (площадь $0.05$) , эта площадь является частью распределения $H_0$, но попадает в область принятия гипотезы $H_1$.<br>
Это $5\%$ значений, которые будут лежать слишком далеко от среднего арифметического. <br>
И если мы попадем расчетным критерием в эту область, то мы ошибочно примем альтернативную гипотезу $H_1$, когда на самом деле была верна нулевая гипотеза $H_0$.  <br>
Поскольку мы заранее устанавливаем уровень статистической значимости $α$, то иными словами можно сказать, что мы в $5\%$ случаев разрешаем ошибиться, а именно принять альтернативную гипотезу, когда на самом деле верна нулевая гипотеза. <br>
Это и есть ошибка $I$ рода, а $α$ – это вероятность ошибки первого рода. <br>
Есть $5\%$ вероятность, что мы найдем отличия, когда их на самом деле нет.

![Ошибки при тестировании гипотез](/Pictures/005_006.png)

Так же на графике мы видим $β$ – это вероятность ошибки $II$ рода. <br>
По графику понятно, что если, расчетное значение критерия попадет в этот регион, то будет ошибочно принята нулевая гипотеза, когда на самом деле верна альтернативная. <br>
Т.е. не найдем различия там, где они на самом деле были.

И еще одна площадь на графике - это $(1- β)$ – это мощность теста.<br>

Мощность теста - это вероятность найти отличия, когда они на самом деле есть. <br>
Мощность теста должна быть не менее $80\%$. <br>
Следовательно, вероятность ошибки $II$  рода не должна превышать $20\%$. <br>
Если мы будем уменьшать $α$, то будет расти $β$. <br>
Посмотрите на график и мысленно сдвиньте красную линию вправо, уменьшая красную площадь, тогда фиолетовая площадь $(β)$ будет расти. 

Итак, до начала теста нужно определиться с α и мощностью теста. <br>
Исходя из этого, высчитывается нужный объем выборки, который обеспечит нам надежность результата. <br>
Мы не будем затрагивать расчеты выборок. <br>
Но упомяну, что для расчета выборки также нужно определиться с размером эффекта. 

Размер эффекта - это то отличие, которое вы хотите искать, ради которого начинаете исследование. <br>
Размер эффекта обосновывается с практической или научной точки зрения. <br>
Например, детали с размером $10$ мм установятся в какой-то прибор, а вот с размером $11$ мм и выше нам не подойдут, потому что мы не сможем их установить в прибор. <br>
Тут размер эффекта $1$ мм.

![Варианты альтернативной гипотезы (z распределение)](/Pictures/005_028.PNG)

![Варианты альтернативной гипотезы (z распределение)](/Pictures/005_029.PNG)

![Этапы проверки гипотезы](/Pictures/005_030.PNG)

![Этапы проверки гипотезы](/Pictures/005_031.PNG)

![Этапы проверки гипотезы](/Pictures/005_032.PNG)

[План лекции](#план-лекции-5)

<hr>

## Критерий Стьюдента.

Мы уже в начале обсуждали, что если неизвестна сигма генеральной совокупности и соблюдаются остальные условия применимости параметрических тестов, то следует использовать критерий Стьюдента. 

Как и любой тест гипотезы, идея та же. <br>
Найти расчетное значение критерия и сравнить с табличным. Формула для нахождения расчетного критерия та же.

$t_н=\dfrac{\bar X - \mu}{\dfrac{\sigma _н}{\sqrt{n}}}$

Только сигму мы рассчитываем по выборке, причем используем формулу для несмещенного стандартного отклонения. <br>
Для нахождения табличного значения используем таблицу распределения Стьюдента.

Распределение Стьюдента оно зависит от степеней свободы, не буду утомлять Вас определением, а проще говоря, степени свободы здесь будут находиться как разность объема выборки и $1$. <br>
Т.е. распределение Стьюдента зависит от объема выборки. <br>
С увеличением объема выборки оно стремится к нормальному стандартному распределению.

Например, по таблице ниже найдем табличное значение для $α = 5\%$. <br>
На графике заштрихована площадь $p$, а $α$  не заштрихована. <br>
Значит, нам надо найти $p=95\%$. <br>
И предположим, что объем выборки был $10$. <br>
Т.е. $9$ степеней свободы. <br>
Табличное значение будет равно $1.833$. 

![Критерий Стьюдента](/Pictures/005_007.png)

![Таблица Стьюдента](https://fsd.multiurok.ru/viewImage.php?image=http://nice-diplom.ru/templates/blue/images/img/form_69.gif)

Чтобы сделать вывод, мы схематично рисуем графики, как для тестирования гипотезы с использованием $Z$ критерия (помним, что распределение Стьюдента с увеличением выборки стремится к стандартному нормальному распределению).

![Критерий Стьюдента](/Pictures/005_008.png)

Т.е. такие схематичные рисунки универсальны для критерия $Z$ и $t$, только пользуемся разными таблицами для нахождения табличного критерия.

![Этапы проверки гипотезы](/Pictures/005_045.PNG)

[План лекции](#план-лекции-5)

<hr>

## P-value

Когда мы проводим тестирование гипотезы мы обращаемся к такому термину как p-value.

![P- value](/Pictures/005_033.PNG)

Ему дают разные определения, но наиболее корректное – __это вероятность увидеть такое же или более экстремальное значение, чем наблюдаемое, при условии, что нулевая гипотеза верна.__

Вспомним задачу с деталями и смотрим на график ниже. <br>
Мы получили расчетное значение $Z_н=1.2$. <br>
На графике p-value  - эта та площадь, которая лежит за наблюдаемым (расчетным значением). <br>
И эта площадь больше, чем площадь за отсечкой $α$,  и при этом $Z$ расчетное попадает в область принятия нулевой гипотезы $H_0$. <br>
Т.е. если pvalue будет больше, чем заранее установленный уровень статистической значимости, то это означает, что верна нулевая гипотеза. 

![P-value](/Pictures/005_009.png)

А теперь представим, что $Z_н$ расчетное получилось не $1.2$, а , например, $2$,т.е. больше, чем табличное значение $1.645$. <br>
Тогда $Z_н$ упадет в область принятия альтернативной гипотезы $H_1$.

И тогда p-value ( та площадь, что находится за $Z_н$)  будет меньше площади $α$ и это означает, что верна альтернативная гипотеза. <br>
Т.е. когда p-value  меньше заранее установленного уровня статистической значимости $α$, то верна альтернативная гипотеза.
Давайте еще рассмотрим одну задачу в Python

![Пример задачи. Распределение Стьюдента.](/Pictures/005_034.PNG)

У нас дана некоторая выборка $x$ (те же детали), только объем будет $12$ и сигма генеральной совокупности нам не известна. <br>
И производитель заверяет, что  он изготавливает детали размером $10$ мм.<br>
Мы помним, что расчетное значение критерия Стьюдента находится по формуле:

$t_н=\dfrac{\bar X - \mu}{\dfrac{\sigma _н}{\sqrt{n}}}$

Произведем эти действия в Python  и мы видим, что  $t≈0.814$,  а табличное значение критерия Стьюдента около $1.8$ (для $11$ степеней свободы и $p= 0.95$)

![P-value](/Pictures/005_010.png)

А теперь давайте воспользуемся готовой функцией.

![P-value](/Pictures/005_011.png)

И мы получили statistic  (расчетное значение критерия) около $0.814$.

Такое же значение мы получили при расчете по формуле. А  $p-value ≈0.433$

Давайте изобразим результаты на графике

![P-value](/Pictures/005_012.png)

Голубым изображена площадь, соответствующая $p-value (0.433)$, а красным – площадь отсечки $α (0.05)$. Эта площадь соответствует табличному значению критерия Стьюдента $1.8$.

И по графику видим, что у нас верна нулевая гипотеза, $p-value > α$. <br>
Т.о. чтобы Вам интерпретировать результат функции необходимо просто посмотреть на pvalue  и сравнить его с заранее установленным уровнем статистической значимости $α$.

![Интерпретация результата pvalue](/Pictures/005_035.PNG)

Запомните! Если $pvalue < α$ , то верна альтернативная гипотеза $H_1$.

![pvalue](/Pictures/005_047.PNG)

Выбор значения $α$ влияет на принятие решения

Мы взяли $α$, по нему мы нашли $t_{критическое}$, по нему мы нашли критическую область и сделали вывод о принятии нулевой или альтернативной гипотезы.

Если мы берем разную $α$ то критические значения меняются и выводы - меняются.

![pvalue](/Pictures/005_050.PNG)

Для того чтобы провести полный анализ нам нужно пересчитывать результат для разных $α$ или взять $t_{наблюдаемое}$ и по нему посчитать $P-value$ и сравнивая его с $α$, делать выводы:
+ отвергается гипотеза
+ или нет.

![pvalue](/Pictures/005_051.PNG)

[План лекции](#план-лекции-5)

<hr>

## Виды статистических гипотез

Давайте теперь рассмотрим, какие бывают виды статистических гипотез. <br>

![Виды статистических гипотез](/Pictures/005_036.PNG)

Мы уже обсудили ранее, что тест может быть односторонним и двусторонним. <br>
Примеры с односторонним тестом мы рассмотрели.

Если же у нас тест двусторонний, т.е. альтернативная гипотеза сформулирована, как показано на графике, то уровень статистической значимости $α$ делится пополам. <br>
И у нас появляется две области принятия альтернативной гипотезы. 

Этот схематичный рисунок подойдет и для $Z$ теста и для $t$ теста. <br>
Если, например, альфа $5\%$, используем $Z$ тест, то табличные значения будут $±1.96$, соответствуют красным осечкам $\dfrac{α}{2}$.

![Виды статистических гипотез](/Pictures/005_013.png)

Тест может быть одновыборочными и двухвыборочными.

Примеры, которые мы рассмотрели, это и были примеры __одновыборочных__ тестов. <br>
Когда мы с такими тестами можем столкнуться? <br>
Например, мы хотим сделать большую закупку какой-то продукции и нам нужно проверить соответствие ее определенному размеру. <br>
Как в задаче поставщик заявлял размер деталей $10$ мм, а мы из его генеральной совокупности взяли выборку и получили среднее по выборки $10.3$. <br>
И мы сравниваем  среднее по выборке  со средним генеральной совокупности.

__Двухвыборочные__ тесты – это тесты, где данные представляют разные совокупности. <br>
Например. <br>
Мы хотим сравнить вес людей на диете и вес людей на обычном питании. <br>
Сравниваем средние арифметические двух выборок. <br>

Или сравниваем среднее давление в выборке до приема лекарства  со средним давлением после приема лекарства. <br>
До приема лекарства – это были люди, не принимающие лекарство, а после приема эти люди представляют другую генеральную совокупность, ту, где люди принимают это лекарство.

Только что я привела $2$ примера с весом и с давлением. <br>
Для выполнения теста в Python вам понадобятся разные функции, потому что первый случай с весом- это независимые выборки, а второй пример с давлением- это зависимые выборки.

Т.е. __двухвыборочные__ тесты в свою очередь бывают с зависимыми и независимыми выборками.

С независимыми выборками, думаю, все понятно, это , когда между выборками нет никакой связи: есть представители одной популяции, что придерживается диеты, и есть представители другой популяции, которые не следуют никаким диетам.

А вот приведу примеры зависимых выборок. <br>
+ Это могут быть одни и те же люди, но сначала измерения сняты до приема лекарства, а потом - после. <br>

+ Если мы изменим эксперимент с диетой и вычислим средний вес до диеты и после , то выборки станут зависимыми. <br>

+ Или другой пример, сравниваем рост матерей и рост их взрослых дочерей. <br>
Это тоже зависимые выборки. <br>

+ Или измеряем какой-то параметр у близнецов. <br>
Тогда это тоже зависимые выборки. 

+ Или пример: зрение правого и левого глаза. <br>
Это все примеры зависимых выборок.

Ниже приведены функции для использования на языке Python.

![Виды статистических гипотез](/Pictures/005_014.png)

[План лекции](#план-лекции-5)

<hr>

## Проверка на нормальность (Шапиро - тест и QQ-график)

Ну и заключительное. <br>
Мы сказали, что параметрические тесты надо использовать, когда у нас есть уверенность, что выборка взята из нормально распределенной совокупности ну или хотя бы приблизительно соблюдаются условия нормальности.

Мы можем проверить нашу выборку на нормальность с помощью разных тестов на нормальность. 

Например, тест Шапиро- Уилка. <br>
Где нулевая гипотеза о том, что нет отличий от нормального распределения и альтернативная гипотеза, что  распределение отлично от нормального. 

Помним, в альтернативную гипотезу мы вкладываем наличие различий!

Но проблема в том, что подобные тесты очень чувствительны к объему выборки. <br>
И если вы используете большие объемы выборок (сотни, тысячи единиц в выборке), то такой тест может показать вам очень маленькое значение pvalue, что будет свидетельствовать об отклонениях от нормальности. Т.е. с увеличением выборок тест будет обнаруживать даже малейшие отклонения от нормальности. 

Поэтому, если Вы столкнулись с большими объемами выборок, лучше использовать графический метод оценки на нормальность $QQ-$ плот ( квантиль-квантиль график).

Сгенерируем выборку $S$ объемом $50$ из нормально распределенной генеральной совокупности со средним арифметическим $0$ и стандартным отклонением $1$.

![Проверка на нормальность](/Pictures/005_015.png)

Применим Шапиро-тест

Статистик получился $0.9925$ , а $pvalue  ≈ 0.987$, что свидетельствует в пользу нулевой гипотезы, что нет отличий от нормального распределения.

А теперь рассмотрим $QQ-$ график

![Проверка на нормальность](/Pictures/005_016.png)

![Проверка на нормальность](/Pictures/005_017.png)

Красная линия на этом графике символизирует нормальное распределение, а синие точки - это $50$ значений выборки $S$. <br>
Чем ближе к красной прямой лежат точки, тем лучше аппроксимация нормальному распределению. <br>
Здесь практически все точки лежат на красной прямой, мы смело говорим, что выборка следует нормальному распределению.

![QQ](/Pictures/005_037.PNG)

Идея графика заключается в следующем:
+ по оси $х$ теоретические квантили, а
+ по оси y упорядоченные значения. 

_Теоретические квантили_ – это квантили нормального стандартного распределения. <br>
Т.е. это $z$ значения. 

Помним таблицу z-значений? <br>
Мы искали, например, какая доля лежит ниже $1.96$ и получали $97.5\%$ значений. <br>
Вот 1.96 – это и есть квантиль.

А теперь нашу выборку $S$ упорядочим по возрастанию. <br>
Мы можем узнать, какому перцентилю соответствует каждое значение этой выборки. 

Вспоминаем описательную статистику на 3й лекции.  <br>
Мы искали $1$ квартиль, помните? <br>
Т.е. мы искали, а ниже какого значения в выборке, лежат $25\%$ значений. <br>
А у нас в выборке $50$ значений. <br>
И мы можем находить, какому перцентилю соответствует каждое из этих значений. Но эти же перцентили мы можем взять и для нормального стандартного распределения и найти для них квартили.

Посмотрите, пожалуйста, на рисунок ниже. <br>
Черным __схематично__ обозначено нормальное стандартное распределение, а фиолетовым __схематично__ обозначено распределение $50$ значений выборки $S$. <br>
Отсечем $30\%$ выборки $S$ и получим «практическое» значение $(п)$, а затем отсечем точно такую же долю у нормального распределения и получим «теоретический» квантиль $(т)$. <br>

Так вот это значение, которое соответствует $30-$му перцентилю в выборке как бы имеет две координаты на $QQ$-графике (т,п) и соответственно  откладывается по оси $х$ и $у$ (теоретический квантиль и упорядоченное значение в выборке). <br>
Но если бы наше распределение точно бы повторяла форму нормального распределения, то мы бы видели только одну черную колоколообразную кривую и квантили теоретические совпадали бы с практическими. 

Вот именно так и строится красная линия на $QQ$ - графике. <br>
Поэтому, чем ближе к красной линии, тем надежнее наше предположение о нормальности распределения.

![Проверка на нормальность](/Pictures/005_018.png)

Сегодня мы
+ изучили тестирование гипотез,
+ узнали, какие бывают виды тестирования гипотез,
+ познакомились с параметрическими тестами,
+ научились делать проверку на нормальность.

На следующем уроке будем знакомиться с доверительными интервалами, в основе которых также лежит центральная предельная теорема.

[План лекции](#план-лекции-5)

<hr>

## Решение задач Семинар 5

### Вопрос 1

![Вопрос 1](/Pictures/005_052.PNG)

![Вопрос 1](/Pictures/005_053.PNG)

### Вопрос 2

Показать область ошибки 1го рода, показать область ошибки 2го рода

$a$ - вероятность отвергнуть нулевую гипотезу

![Вопрос 2](/Pictures/005_054.PNG)

![Этапы проверки гипотезы](/Pictures/005_045.PNG)

### Задача 1

Ниже приведены диаметры коронарных артерий после приема нифедипина и плацебо. 

Позволяют ли приводимые ниже данные утверждать, что нифедипин влияет на диаметр коронарных артерий?
1. Выполнить расчеты в Python
2. Сделайте расчет в ручную
3. Сравните критерий Стьюдента и p-value со значениями, полученными в Python

```python
x = np.array([2.5, 2.2, 2.6, 2, 2.1, 1.8,2.4, 2.3, 2.7, 2.7, 1.9])
y = np.array([2.5, 1.7, 1.5, 2.5, 1.4, 1.9, 2.3, 2.0, 2.6, 2.3, 2.2])
```

$t_н = \dfrac{\overline{X_1}−\overline{X_2}}{\sqrt {\dfrac{\sigma_1^2}{𝑛_1} + \dfrac{\sigma_2^2}{𝑛_2}}}$

Используемая литература для подготовки задач к семинару: 
Гланц С. «Медико-биологическая статистика»

### Решение

1. Сформулируем две версии:<br>
$H_0: \mu_x = \mu_y$ - нифедипин не работает, математическое ожидание(среднее арифметическое) обоих множеств - совпадает<br>
$H_1: \mu_x \neq \mu_y$ - нифедипин работает и влияет на диаметр коронарных артерий.

2. В идеале, на данном этапе мы должны проверить эти распределения на нормальность, но в данном случае мы это опускаем, считая что множества - нормальны

3. Фиксируем $\alpha = 0.05$ - уровень значимости $5\%$

4. Выбираем статистический критерий, так как от генеральной совокупности нам не известна $\sigma$, то мы применим критерий Стьюдента, однако, формула изученная на лекции:<br>
$t_н = \dfrac {\overline{X} - \mu_0}{\dfrac{\sigma_н}{\sqrt{n}}}$<br>
не подходит для данного случая, так как нулевая гипотеза в данном случае что $H_0: \mu = \mu_0$, что среднее равно какому-то конкретному значению.<br>
Мы применим формулу предложенную в этой задаче:<br>
$t_{наблюдаемое} = \dfrac{\overline{X_1}−\overline{X_2}}{\sqrt {\dfrac{\sigma_1^2}{𝑛_1} + \dfrac{\sigma_2^2}{𝑛_2}}}$,<br> для случаев когда мы тестируем равенство средних.

![Задача 1](/Pictures/005_055.PNG)

[Решение python](/S005.ipynb)

```python
import numpy as np
import scipy.stats as stats

x = np.array([2.5, 2.2, 2.6, 2, 2.1, 1.8,2.4, 2.3, 2.7, 2.7, 1.9])
y = np.array([2.5, 1.7, 1.5, 2.5, 1.4, 1.9, 2.3, 2.0, 2.6, 2.3, 2.2])

x_mean = np.mean(x) # Считаем среднее по x
y_mean = np.mean(y) # Считаем среднее по y
x_v = np.var(x, ddof=1) # Считаем несмещенную дисперсию по x
y_v = np.var(y, ddof=1) # Считаем несмещенную дисперсию по y
n_x = len(x) # количество элементов выборки x
n_y = len(y) # количество элементов выборки Y
print(x_mean, y_mean, x_v, y_v, n_x, n_y)
result = [round(k, 4) for k in (x_mean, y_mean, x_v, y_v, n_x, n_y)]
result

# 2.2909090909090906 2.0818181818181816 0.10090909090909095 0.17163636363636364 11 11

# [2.2909, 2.0818, 0.1009, 0.1716, 11, 11]

t_emp = (x_mean - y_mean) / np.sqrt(x_v / n_x + y_v / n_y)
t_emp

# 1.3283484757831465
```

$t_{наблюдаемое} = 1.3283$

5. Для оценки гипотез мы должны посчитать $p-value$, но мы посчитаем $t_{критическое}$<br>

```python

alpha = 0.05
n = n_x

t1 = stats.t.ppf(alpha / 2, df=2 * (n - 1))
t2 = stats.t.ppf(1 - alpha / 2, df= 2 * (n - 1))
t1, t2 # находим критические значения

# (-2.085963447265837, 2.0859634472658364)

```
$t_{наблюдаемое} = 1.3283$

$t_{критическое}= (-2.08, 2.08)$

$t_{наблюдаемое}$ попадает в промежуток между $t_{критическое}$, следовательно нулевая гипотеза не отвергается, лекарство не действует!

![вывод](/Pictures/005_056.PNG)

В лекции был примет встроенного теста применим его
```python
stats.ttest_ind(x, y) # для независимых выборок

# Ttest_indResult(statistic=1.3283484757831463, pvalue=0.19902265798859645)
```
$\alpha = 0.05$

$p-value=0.199$

$p-value > \alpha$

$H_0$ не отвергается, лекарство не работает!

### Задача 2

Ниже приведены данные из исследования Фреба и Уайта, посвященному исследованию состоянию легких. <br>
Мы возьмем данные для группы людей, которые работали в накуренном помещении и для людей, выкуривающих небольшое число сигарет в день.<br>

Объемы выборок одинаковые – по $200$ человек. 

Для людей, работающих в накуренном помещении средняя скорость средины выдоха составляет $2,72, std = 0.71$, а выкуривающих 
небольшое число сигарет $2,63, std = 0.73$.

Можно ли считать одинаковой максимальную объемную скорость середины выдоха одинаковой в обеих группах?

### Решение

1. Сформируем гипотезы <br>
$H_0: \mu_x = \mu_y$<br>
$H_1: \mu_x \neq \mu_y$

2. Зафиксируем $\alpha = 0.05$

3. Так как здесь двухвыборочный тест используем статистику из предыдущей задачи:<br>

$t_{наблюдаемое} = \dfrac{\overline{X_1}−\overline{X_2}}{\sqrt {\dfrac{\sigma_1^2}{𝑛_1} + \dfrac{\sigma_2^2}{𝑛_2}}}= \dfrac{2.72−2.63}{\sqrt {\dfrac{0.71^2 + 0.73^2}{200}}} \approx 1.249$

4. Найдем $t_{критическое}$ <br>
$t_{критическое} = 1.9659$

```python

# Задача 2

alpha = 0.05
n = 200

t1 = stats.t.ppf(alpha / 2, df=2 * (n - 1))
t2 = stats.t.ppf(1 - alpha / 2, df= 2 * (n - 1))
t1, t2 # находим критические значения

# (-1.965942323976193, 1.9659423239761926)
```

5. $t_{наблюдаемое} < t_{критическое}$, <br>
следовательно нулевая гипотеза не отвергается, вред от работы в прокуренном помещении и выкуривании небольшого количества сигарет одинаков

![Двусторонний критерий Стьюдента](/Pictures/005_057.PNG)

Использование python, это отчасти аналог использования таблиц

### Задача 3

Утверждается, что средний рост мужчин национальности $Х$ $179,5$.<br>
Была взята выборка из $100$ человек, по которой получилось среднее
арифметическое $178,5$.

Проверить это утверждение с помощью одностороннего теста, если известно, что стандартное отклонение генеральной совокупности $3$ см.

А уровень статистической значимости принять за $1\%$

### Решение

![Этапы проверки гипотезы](/Pictures/005_045.PNG)

1. Сформулируем нулевую и альтернативную гипотезы:<br>
$H_0: \mu_x = 179.5$<br>
$H_1: \mu_x < 179.5$

2. Так как в этой задаче определена $\sigma (СКО) = 3$ генеральной совокупности используем формулу:<br>
$Z_н=\dfrac{\bar X - \mu}{\dfrac{\sigma}{\sqrt{n}}}$

3. Уровень значимости $\alpha = 0.01 (1\%)$

$Z=\dfrac{178.5 - 179.5}{\dfrac{3}{\sqrt{100}}} = \dfrac{-10}{3} \approx -3.33$

4. Определим критическую область:

```python

# Задача 3
alpha = 0.01
n = 100

t1 = stats.norm.ppf(alpha)  # ЛКО - левосторонняя критическая область

t1

# -2.3263478740408408
```
![Задача 3](/Pictures/005_059.PNG)

Мы можем найти значение $t_{критическое}$ при помощи таблицы
5. 
$t_{наблюдаемое} < t_{критическое}$, следовательно $H_0$ нулевая гипотеза отвергается

![Задача 3](/Pictures/005_058.PNG)

[План лекции](#план-лекции-5)

<hr>

[Содержание курса](/README.MD)

<hr>

